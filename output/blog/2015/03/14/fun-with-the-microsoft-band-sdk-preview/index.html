<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Fun with the Microsoft Band SDK Preview &mdash; mlindgren.ca</title>
  <meta name="author" content="Mitch Lindgren">






  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">


    <link href="/favicon.png" rel="icon">

  <link href="/theme/css/main.css" media="screen, projection"
        rel="stylesheet" type="text/css">

  <link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic"
        rel="stylesheet" type="text/css">
  <link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic"
        rel="stylesheet" type="text/css">

  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=Open+Sans:400,700" rel="stylesheet" type="text/css">

<!--
/* @license
* MyFonts Webfont Build ID 1737828, 2011-12-16T22:03:39-0500
*
* The fonts listed in this notice are subject to the End User License
* Agreement(s) entered into by the website owner. All other parties are 
* explicitly restricted from using the Licensed Webfonts(s).
*
* You may obtain a valid license at the URLs below.
*
* Webfont: Museo 700 by exljbris
* URL: http://www.myfonts.com/fonts/exljbris/museo/700/
* Copyright: Copyright (c) 2008 by Jos Buivenga/exljbris. All rights reserved.
* Licensed pageviews: unlimited
*
*
* License: http://www.myfonts.com/viewlicense?type=web&buildid=1737828
*
* Â© 2011 Bitstream Inc
*/
-->
<link rel="stylesheet" type="text/css" href="/theme/css/mlindgren_ca_museo700.css">

<!-- Load jQuery -->
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"
type="text/javascript"></script>
<script type="text/javascript">
    jQuery.noConflict(); // ender.js conflicts with jQuery
</script>

 <!-- Load FancyBox -->
 <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" />
 <script src="/fancybox/jquery.fancybox.pack.js" type="text/javascript">
 </script>

<!-- Custom Scripts -->
<script language="Javascript" type="text/javascript">
// ender.js gobbles jQuery's ready event: Use ender.js $ instead
$(document).ready(function() {
    jQuery(".fancybox").fancybox(
    {
      helpers:
      {
        overlay:
        {
          locked: false
        }
      }
    });
});
</script>

</head>

<body>
  <header role="banner"><hgroup>
  <h1><a href="/">mlindgren.ca</a></h1>
</hgroup>
<div id="header-outer-wrap">
  <div id="header-wrap">
    <div id="header-background">
      <img src="theme/images/header.jpg" class="header-background-stretch">
    </div>
  </div>
</div></header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
</ul>


<ul class="main-navigation">
      <li class="active">
        <a href="/category/coding.html">Coding</a>
      </li>
      <li >
        <a href="/category/links.html">Links</a>
      </li>
      <li >
        <a href="/category/other.html">Other</a>
      </li>
      <li >
        <a href="/category/reviews.html">Reviews</a>
      </li>
      <li >
        <a href="/category/technology.html">Technology</a>
      </li>
</ul></nav>
  <div id="main">
    <div id="content">
<div class="category-coding">
  <article class="hentry" role="article">
<header>
      <h1 class="entry-title">Fun with the Microsoft Band SDK Preview</h1>
    <p class="meta">
<time datetime="2015-03-14T02:07:34-07:00" pubdate>Sat 14 March 2015</time>    </p>
</header>

  <div class="entry-content"><p>First of all, happy <a href="http://en.wikipedia.org/wiki/Pi_Day">Pi Day</a>! Using the standard United States
date format, today is 3/14/15, which makes it the most significant Pi Day this century.</p>
<p>Anyway, I've spent the past few hours tinkering with the
<a href="http://developer.microsoftband.com/">Microsoft Band SDK Preview</a>, and although I think it's
unfortunate that there's no SDK for writing apps which actually run on the Band itself, you can
still accomplish some pretty cool things with the phone SDK. Unfortunately, this being a preview
release, the documentation is a bit sparse, and I had some trouble figuring out how to get things
working. Thus, I wanted to share some of what I've learned. If you prefer to dive right into the
code, I've got a small C# sample application <a href="https://github.com/mlindgren/BandDemo">on GitHub</a>.</p>
<p>Standard disclaimer: although I am a Microsoft employee, everything I am posting here and on GitHub
is my own personal work done on my own time. None of it should be considered as officially
representative of Microsoft in any respect. While I will do my best to answer any questions I can
related to the Band SDK Preview, I cannot provide official support for this or any other Microsoft
product.</p>
<p>Let's get started. If you're following
<a href="http://developer.microsoftband.com/docs/MicrosoftBandSDKPreview.pdf">the documentation</a>, the first
few steps describe how to connect to the Band, as one would expect. The sample code provided creates
a connection within a <code>using</code> block. This ensures that the connection is disposed of as soon as
control leaves the block, which is sensible since maintaing a connection to the Band, especially
when subscribed to multiple sensors, can severely impact its battery life. However, this approach
can also be a bit misleading, because if you <em>do</em> want to collect data from the Band over some
interval of time, you will only be able to do so during the lifetime of the <code>IBandClient</code> returned
by <code>ConnectAsync</code>. As soon as the <code>IBandClient</code> is disposed of, your connection will be closed and
you will no longer receive sensor data.</p>
<p>Since you'll typically only be connected to one Band at a time, the easiest way to solve this
problem is to store the <code>IBandClient</code> as a static member variable of your <code>Application</code> class.
(Note: I don't guarantee that this is the <em>optimal</em> solution. I am by no means an expert here.) This
also makes it easy to access your Band client from different pages within your application, and to
unsubscribe from sensor data when you no longer need it so that you won't drain the Band's
battery.</p>
<p>[<strong>Updated March 17, 2015:</strong> In my original post, I was missing a call to <code>Dispose()</code> before setting
the <code>IBandClient</code> member to <code>null</code>. As Phil pointed out in the comments, this is a bad practice,
because garbage collection of the <code>IBandClient</code> may not happen immediately, in which case the
connection to the Band would be left open for some time. During that time, other applications would
be prevented from connecting to the Band. I have corrected this error in my code below, and in my
project on GitHub. If you are only connecting to the Band for a short time, you can use a <code>using</code>
block instead, as discussed above, which will ensure that <code>Dispose()</code> is called for you. Thanks to
Phil for the correction.]</p>
<p>{% codeblock lang:csharp App.xaml.cs %}
using Microsoft.Band;</p>
<p :=":" App="App" Application_="Application
" BandClient_="BandClient
" IBandClient="IBandClient" _="{
" class="class" get_="get;" partial="partial" public="public" sealed="sealed" set_="set;
" static="static">namespace BandDemo</p>
<div class="highlight"><pre>// ...

private async void OnSuspending(object sender, SuspendingEventArgs e)
{
    var deferral = e.SuspendingOperation.GetDeferral();

    if(App.BandClient != null)
    {
        // Unsubscribe from sensor data so that we don&#39;t drain the Band&#39;s battery when
        // the app is not in use.
        await App.BandClient.SensorManager.Accelerometer.StopReadingsAsync();
        await App.BandClient.SensorManager.Gyroscope.StopReadingsAsync();
        await App.BandClient.SensorManager.HeartRate.StopReadingsAsync();

        // Call Dispose to close the connect to the Band
        App.BandClient.Dispose();

        // We are done with this client, so assign null to the member variable so the
        // IBandClient can be garbage collected
        App.BandClient = null;
    }

    deferral.Complete();
}
</pre></div>


<p _="%" endcodeblock="endcodeblock">}
}</p>
<p>{% codeblock lang:csharp MainPage.xaml.cs %}
using Microsoft.Band;
using Microsoft.Band.Sensors;</p>
<p>namespace BandDemo
{
  public sealed partial class MainPage : Page
  {</p>
<div class="highlight"><pre>// ...

protected async override void OnNavigatedTo(NavigationEventArgs e)
{
  IBandInfo[] pairedBands = await BandClientManager.Instance.GetBandsAsync();

  try
  {
      App.BandClient = await BandClientManager.Instance.ConnectAsync(pairedBands[0]);

      // Do work after successful connect
      System.Diagnostics.Debug.WriteLine(&quot;Connected!&quot;);
  }
  catch(Exception)
  {
    System.Diagnostics.Debug.WriteLine(&quot;Connection failed!&quot;);
  }
}
</pre></div>


<p _="%" endcodeblock="endcodeblock">}
}</p>
<p>The next thing you'll notice in the documentation is that it recommends that you query the device
for available reporting intervals for each sensor. It's fairly easy to miss that setting the
reporting interval is <em>completely optional</em>; you can feel free to skip this step unless you really
need fine-grained control over how frequently you get updates.</p>
<p>Finally, the documentation describes how to subscribe to sensor data by adding your callback to a
sensor's <code>ReadingChanged</code> property. When your callback is executed, you might want to update your
app's UI to indicate the new reading (indeed, the documentation itself suggests this). However, this
is another gotcha because in Windows (Phone) Store apps, "all UI components share the same [UI]
thread," (<a href="https://msdn.microsoft.com/en-us/library/windows/apps/hh994635.aspx">reference</a>), and
methods on this thread cannot be directly invoked by background threads. If you try to do so, an
exception will be raised. This will of course be no surprise to those of you already familiar with
Store apps (or even with .NET circa 2006), but for the rest of us, it can be a bit confusing.
Luckily, the solution is simple: you just need to use <code>Dispatcher.RunAsync</code> to do your UI updates.
So, putting it all together, here's how you subscribe to sensor data and update the UI when it
changes:</p>
<p>{% codeblock lang:csharp %}
App.BandClient.SensorManager.Accelerometer.ReadingChanged += async (sender, args) =&gt;
{
  await Dispatcher.RunAsync(Windows.UI.Core.CoreDispatcherPriority.Normal, () =&gt;
  {
    AccelerometerXValue.Text = args.SensorReading.AccelerationX.ToString("###00.00");
    AccelerometerYValue.Text = args.SensorReading.AccelerationY.ToString("###00.00");
    AccelerometerZValue.Text = args.SensorReading.AccelerationZ.ToString("###00.00");</p>
<div class="highlight"><pre>System.Diagnostics.Debug.WriteLine(&quot;Got accelerometer event!&quot;);
</pre></div>


<p>});
};</p>
<p _="%" endcodeblock="endcodeblock">await App.BandClient.SensorManager.Accelerometer.StartReadingsAsync();</p>
<p>That's it for now! If you have any questions, leave a comment and I'll do my best to answer them.</p></div>
    <footer>
<p class="meta">
  <span class="byline author vcard">
    Posted by <span class="fn">
        Mitch Lindgren
    </span>
  </span>
<time datetime="2015-03-14T02:07:34-07:00" pubdate>Sat 14 March 2015</time>  <span class="categories">
    <a class='category' href='/category/coding.html'>Coding</a>
  </span>
</p><div class="sharing">
</div>    </footer>
  </article>

</div>
<aside class="sidebar">
  <section>
    <h1>Pages</h1>
    <ul id="sidebar_pages">
      <li><a href="">Home</a></li>
      <li><a href="/archives.html">Archives</a></li>
    </ul>
  </section>
  <section>
    <h1>Recent Posts</h1>
    <ul id="recent_posts">
      <li class="post category-other">
          <a href="/blog/2015/09/07/observations-from-three-years-in-america/">Observations from Three Years in America</a>
      </li>
      <li class="post category-technology">
          <a href="/blog/2015/07/29/windows-10/">Windows 10!</a>
      </li>
      <li class="post category-reviews">
          <a href="/blog/2015/05/22/game-review-bloodborne/">Game Review: Bloodborne</a>
      </li>
      <li class="post category-links">
          <a href="/blog/2015/03/17/windows-hello-microsoft-passport-and-tamriel-unlimited/">Windows Hello, Microsoft Passport, and Tamriel Unlimited</a>
      </li>
      <li class="post category-coding">
          <a href="/blog/2015/03/14/fun-with-the-microsoft-band-sdk-preview/">Fun with the Microsoft Band SDK Preview</a>
      </li>
    </ul>
  </section>
  <section>
      
    <h1>Categories</h1>
    <ul id="recent_posts">
        <li class="category-coding">
          <a href="/category/coding.html">Coding</a>
        </li>
        <li class="category-links">
          <a href="/category/links.html">Links</a>
        </li>
        <li class="category-other">
          <a href="/category/other.html">Other</a>
        </li>
        <li class="category-reviews">
          <a href="/category/reviews.html">Reviews</a>
        </li>
        <li class="category-technology">
          <a href="/category/technology.html">Technology</a>
        </li>
    </ul>
  </section>
 

  <section>
  <h1>Tags</h1>
  </section>


    <section>
        <h1>Social</h1>
        <ul>
            <li><a href="#" target="_blank">You can add links in your config file</a></li>
            <li><a href="#" target="_blank">Another social link</a></li>
        </ul>
    </section>
    <section>
        <h1>Blogroll</h1>
        <ul>
            <li><a href="http://slatestarcodex.com" target="_blank">Slate Star Codex</a></li>
        </ul>
    </section>

</aside>    </div>
  </div>
  <footer role="contentinfo"><p>
    Copyright &copy;  2010&ndash;2015  Mitch Lindgren &mdash;
  <span class="credit">Powered by <a href="http://getpelican.com">Pelican</a></span>
</p></footer>
  <script src="/theme/js/modernizr-2.0.js"></script>
  <script src="/theme/js/ender.js"></script>
  <script src="/theme/js/octopress.js" type="text/javascript"></script>
</body>
</html>